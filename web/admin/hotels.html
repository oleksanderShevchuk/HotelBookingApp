<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Hotel Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
</head>
<body x-data="hotelPage()" x-init="load()" class="bg-gray-50 min-h-screen">

    <div class="container mx-auto py-6">
        <a href="index.html" class="text-blue-600">&larr; Back</a>

        <h1 class="text-3xl font-bold mb-4" x-text="hotel.name"></h1>
        <p class="text-gray-600 mb-2" x-text="hotel.city"></p>
        <p class="mb-6" x-text="hotel.description"></p>

        <h2 class="text-2xl font-semibold mb-3">Rooms</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <template x-for="room in rooms">
                <div class="bg-white p-4 shadow rounded">
                    <h3 class="text-lg font-bold">Room <span x-text="room.number"></span></h3>
                    <p>Capacity: <span x-text="room.capacity"></span></p>
                    <p>Price per night: $<span x-text="room.pricePerNight"></span></p>
                    <button @click="book(room.id)"
                            class="mt-2 bg-blue-600 text-white px-3 py-1 rounded">
                        Book
                    </button>
                </div>
            </template>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
    function hotelPage() {
      return {
        hotel: {},
        rooms: [],
        async load() {
          const params = new URLSearchParams(location.search);
          const id = params.get("id");
          const hotelRes = await api.get(`/api/hotels/${id}`);
          this.hotel = await hotelRes.json();
          const roomRes = await api.get(`/api/rooms?hotelId=${id}`);
          this.rooms = await roomRes.json();
        },
        async book(roomId) {
          const token = localStorage.getItem('token');
          if (!token) {
            alert('Please login first');
            location.href = 'login.html';
            return;
          }
          const checkIn = prompt("Enter check-in date (YYYY-MM-DD):");
          const checkOut = prompt("Enter check-out date (YYYY-MM-DD):");
          const res = await api.post('/api/bookings', { roomId, checkInDate: checkIn, checkOutDate: checkOut });
          const text = await res.text();
          alert(text);
        }
      }
    }
    </script>
</body>
</html>
